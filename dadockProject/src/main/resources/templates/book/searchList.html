<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<link rel="icon" type="image/png" href="/public/paper_img/favicon.1.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta charset=UTF-8>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
	<title>Dadock::다독</title>
</head>
<body>
<header th:insert="headerNav"></header>
	<div class="container">
      <div class="row">
        <div class="col">
          <form method="get" role="searchbox" action="../searchList/1">
          	<div class="col-sm-4 input-group mt-3">
          		<button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          			<i class="bi bi-menu-down"></i>
          		</button>
          		<ul class="dropdown-menu">
    				<li><a class="dropdown-item" href="#">제목,키워드</a></li>
				    <li><a class="dropdown-item" href="#">저자</a></li>
				   	<li><a class="dropdown-item" href="#">ISBN</a></li>
				</ul>
            	<input type="search" class="form-control" placeholder="도서 검색" name="text" required>
         		<button class="btn btn-outline-secondary" type="submit">
         			<i class="bi bi-search"></i>
         		</button>
          	</div>
          </form>
        </div>
      </div>
      <hr>
      <p></p>
<p th:text="|검색 결과 수 : ${total}|" style="text-align: right;"></p>
     <div class="d-flex justify-content-center" th:insert="/bookListPaging"></div>
      <div class="row" style="justify-content: space-between;">
      	<!-- 검색결과 존재하지 않을 때 -->
      	<th:block th:if="${total==0}">
      	<div class="col-12" style="text-align: center;">
      		<h2>검색 결과가 없습니다.</h2>
      	</div>
      	</th:block>
      	
      	<!-- 검색결과 존재할 때 -->
	    <th:block th:each="book : ${bookList}">
      	<div class="col-md-6 border" style="height: vh30;">
      		<div class="row p-4">
	      		<div class="col-4" th:onclick="|location.href='@{../detail/__${book.isbn}__}'|">
	      		<!-- Lazy Loading -->
	      		<th:block th:if="${bookStat.count<7}">
		    	<input type="image" th:src="${book.image}" style="width: 80%;" form="bookDetail">
	      		</th:block>
	      		<th:block th:if="${bookStat.count>=7}">
		    	<input type="image" class="lazy" th:data-src="${book.image}" style="width: 80%;" form="bookDetail">
	      		</th:block>
	      		</div>
	      		<div class="col-6">
				<p th:text="|제목 : ${book.title}|"></p>
				<p th:text="|저자 : ${book.author}|"></p>
				<p th:text="|출판사 : ${book.publisher}|"></p>
				<p th:text="|ISBN : ${book.isbn}|"></p>
	      		</div>
	      		<!-- detail에 보낼 hidden input -->
	      		<form id="bookDetail" action="/book/detail" method="post" name="bookDetail">
	      			<input type="text" name="isbn" th:value="${book.isbn}" hidden readonly/>
	      			<input type="text" name="title" th:value="${book.title}" hidden  readonly/>
	      			<input type="text" name="author" th:value="${book.author}" hidden readonly/>
	      			<input type="text" name="image" th:value="${book.image}" hidden  readonly/>
	      			<input type="text" name="publisher" th:value="${book.publisher}" hidden  readonly/>
	      			<input type="text" name="pubdate" th:value="${book.pubdate}" hidden  readonly/>
	      			<textarea name="description" th:text="${book.description}" hidden  readonly></textarea>
	      			<input type="text" name="link" th:value="${book.link}" hidden  readonly/>
	      		</form>                
      		</div>
      	</div>
	    </th:block>
      </div>
     </div>
     <p></p>
     <div class="d-flex justify-content-center" th:insert="/bookListPaging"></div>
      <hr>
<footer th:insert="footer"></footer>
<script>
/* 이미지 lazy 로딩을 위한 script */
document.addEventListener("DOMContentLoaded", function() {
	  var lazyloadImages;    

	  if ("IntersectionObserver" in window) {
	    lazyloadImages = document.querySelectorAll(".lazy");
	    var imageObserver = new IntersectionObserver(function(entries, observer) {
	      entries.forEach(function(entry) {
	        if (entry.isIntersecting) {
	          var image = entry.target;
	          image.src = image.dataset.src;
	          image.classList.remove("lazy");
	          imageObserver.unobserve(image);
	        }
	      });
	    });

	    lazyloadImages.forEach(function(image) {
	      imageObserver.observe(image);
	    });
	  } else {  
	    var lazyloadThrottleTimeout;
	    lazyloadImages = document.querySelectorAll(".lazy");
	    
	    function lazyload () {
	      if(lazyloadThrottleTimeout) {
	        clearTimeout(lazyloadThrottleTimeout);
	      }    

	      lazyloadThrottleTimeout = setTimeout(function() {
	        var scrollTop = window.pageYOffset;
	        lazyloadImages.forEach(function(img) {
	            if(img.offsetTop < (window.innerHeight + scrollTop)) {
	              img.src = img.dataset.src;
	              img.classList.remove('lazy');
	            }
	        });
	        if(lazyloadImages.length == 0) { 
	          document.removeEventListener("scroll", lazyload);
	          window.removeEventListener("resize", lazyload);
	          window.removeEventListener("orientationChange", lazyload);
	        }
	      }, 20);
	    }

	    document.addEventListener("scroll", lazyload);
	    window.addEventListener("resize", lazyload);
	    window.addEventListener("orientationChange", lazyload);
	  }
	})
</script>
</body>
</html>